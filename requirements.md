# 需求文档

## 项目简介

XRF-Go 是一个简洁高效的 Xray 安装配置工具，设计理念为"高效率，超快速，极易用"。该工具专注核心功能，避免过度工程化，继承 233boy 项目的设计理念，以多配置同时运行为核心设计，专门优化了添加、更改、查看、删除四项常用功能。

## 需求列表

### 需求 1

**用户故事：** 作为系统管理员，我希望通过单个命令安装 Xray，以便快速搭建代理服务器而无需复杂配置。

#### 验收标准

1. 当用户运行安装命令时，系统应自动检测操作系统并安装相应的 Xray 版本
2. 当用户在安装时指定协议时，系统应使用最优默认设置配置该协议
3. 当用户提供域名时，系统应自动配置 TLS 证书和伪装网站
4. 当安装完成时，系统应自动启动 Xray 服务并配置开机自启
5. 如果安装失败，系统应提供清晰的错误信息并回滚任何部分更改

### 需求 2

**用户故事：** 作为代理管理员，我希望向 Xray 配置中添加多个协议，以便支持不同的客户端类型和使用场景。

#### 验收标准

1. 当用户添加新协议时，系统应在 1 秒内为该协议创建独立的配置文件
2. 当配置多个协议时，系统应使用 Xray 的多配置文件特性独立管理它们
3. 当添加协议时，系统应自动分配可用端口并避免冲突
4. 当添加 VLESS-REALITY 时，系统应自动生成所需密钥并配置目标服务器
5. 当添加需要 TLS 的协议时，系统应自动配置证书
6. 如果协议添加失败，系统不应影响现有协议配置

### 需求 3

**用户故事：** 作为代理管理员，我希望管理现有的协议配置，以便根据需要修改、查看或删除协议。

#### 验收标准

1. 当用户列出协议时，系统应显示所有已配置协议及其状态和关键参数
2. 当用户查看特定协议时，系统应显示详细配置，包括连接 URL 和二维码
3. 当用户修改协议配置时，系统应仅更新该协议的配置文件
4. 当用户删除协议时，系统应删除相应的配置文件并在必要时更新路由
5. 当进行配置更改时，系统应在应用更改前验证完整配置

### 需求 4

**用户故事：** 作为系统管理员，我希望管理 Xray 服务，以便控制代理服务器的运行。

#### 验收标准

1. 当用户启动服务时，系统应使用 confdir 模式加载所有配置文件
2. 当用户停止服务时，系统应优雅地关闭 Xray 和所有连接
3. 当用户重启服务时，系统应重新加载所有配置文件，尽可能不丢失现有连接
4. 当用户检查状态时，系统应显示服务状态、活跃协议和基本统计信息
5. 当配置文件更改时，系统应支持热重载而不中断服务

### 需求 5

**用户故事：** 作为代理管理员，我希望使用协议快捷方式和别名，以便快速配置常见的协议组合。

#### 验收标准

1. 当用户使用协议别名（vr、vw、tw、ss 等）时，系统应识别并展开为完整协议名称
2. 当用户使用快捷方式添加协议时，系统应应用协议特定的最优默认值
3. 当用户指定快速命令时，系统应以最少输入完成复杂配置
4. 当使用快捷方式时，系统应提供与完整协议名称相同的功能
5. 如果别名有歧义，系统应提示用户澄清

### 需求 6

**用户故事：** 作为系统管理员，我希望自动系统优化，以便代理服务器无需手动调优即可达到最佳性能。

#### 验收标准

1. 当安装 Xray 时，系统应自动检测并配置 BBR 拥塞控制（如果可用）
2. 当配置协议时，系统应自动为所需端口配置防火墙规则
3. 当需要 TLS 时，系统应自动获取并配置 SSL 证书
4. 当系统启动时，系统应验证所有系统要求是否满足
5. 如果系统优化失败，系统应继续基本配置并记录警告

### 需求 7

**用户故事：** 作为代理管理员，我希望生成连接信息和实用工具，以便轻松向用户分发访问凭据。

#### 验收标准

1. 当用户请求连接 URL 时，系统应生成有效的协议特定连接字符串
2. 当用户请求二维码时，系统应显示供移动客户端扫描的二维码
3. 当用户需要密码或密钥时，系统应生成加密安全的随机值
4. 当用户请求 UUID 时，系统应生成有效的版本 4 UUID
5. 当生成 Shadowsocks 2022 密钥时，系统应使用正确的密钥格式和长度

### 需求 8

**用户故事：** 作为系统管理员，我希望全面的日志记录和监控，以便排查问题和监控系统性能。

#### 验收标准

1. 当系统运行时，系统应以适当的日志级别记录重要事件
2. 当发生错误时，系统应提供详细的错误信息和建议的解决方案
3. 当用户请求日志时，系统应显示带有过滤选项的最近日志条目
4. 当使用 Xray API 时，系统应提供带宽使用和连接数的统计信息
5. 当需要配置测试时，系统应在应用配置前验证配置

### 需求 9

**用户故事：** 作为系统管理员，我希望配置备份和恢复功能，以便防止配置丢失并实现轻松迁移。

#### 验收标准

1. 当用户创建备份时，系统应将所有配置文件和证书保存到单个归档文件中
2. 当用户恢复备份时，系统应恢复所有配置并自动重启服务
3. 当进行备份操作时，系统应在完成前验证备份完整性
4. 当恢复时，系统应在应用恢复的配置前验证其有效性
5. 如果备份或恢复失败，系统应维持当前工作配置

### 需求 10

**用户故事：** 作为开发者或高级用户，我希望 API 访问 Xray 功能，以便与其他系统集成或创建自定义管理工具。

#### 验收标准

1. 当启用 API 时，系统应提供入站管理的端点
2. 当进行 API 调用时，系统应适当地认证和授权请求
3. 当请求统计信息时，系统应返回已配置协议的实时使用数据
4. 当通过 API 进行配置更改时，系统应更新配置文件并根据需要重新加载
5. 当 API 操作失败时，系统应返回适当的 HTTP 状态码和错误信息

### 需求 11

**用户故事：** 作为代理管理员，我希望支持最新的协议和传输方式，以便提供最佳的性能和安全性。

#### 验收标准

1. 当配置 VLESS-REALITY 时，系统应支持最新的 REALITY 传输配置
2. 当配置 HTTPUpgrade 时，系统应正确实现 HTTP 升级传输机制
3. 当配置 WebSocket 时，系统应包含 2025 年的优化参数
4. 当配置 Shadowsocks 2022 时，系统应支持新的加密方法和密钥格式
5. 当配置任何协议时，系统应包含 socket 优化参数以提升网络性能

### 需求 12

**用户故事：** 作为系统管理员，我希望智能端口管理，以便避免端口冲突并优化网络配置。

#### 验收标准

1. 当添加新协议时，系统应自动检测端口占用并分配可用端口
2. 当检测到端口冲突时，系统应提供替代端口建议
3. 当配置多个协议时，系统应智能分配端口以避免冲突
4. 当用户指定端口时，系统应验证端口可用性
5. 如果端口不可用，系统应提供清晰的错误信息和解决建议